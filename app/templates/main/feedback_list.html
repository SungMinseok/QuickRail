{% extends "base.html" %}
{% block title %}í”¼ë“œë°±{% endblock %}

{% block extra_css %}
<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 700;
    white-space: nowrap;
  }
  .status-todo { background: #ecf0f1; color: #2c3e50; border: 1px solid #d7dde3; }
  .status-inprogress { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
  .status-done { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
  .status-wontdo { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

  .pill {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.15rem 0.55rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 700;
    border: 1px solid #ddd;
    background: #f8f9fa;
    color: #495057;
    white-space: nowrap;
  }
  .pill-notice { border-color: #f1c40f; background: #fff8db; color: #7d6608; }
  .pill-admin-only { border-color: #95a5a6; background: #ecf0f1; color: #2c3e50; }

  table.board {
    width: 100%;
    border-collapse: collapse;
  }
  table.board th, table.board td {
    padding: 0.75rem;
    border-bottom: 1px solid #eee;
    vertical-align: middle;
  }
  table.board th {
    text-align: left;
    color: #666;
    font-size: 0.9rem;
    font-weight: 700;
    background: #fafafa;
  }
  .title-link {
    color: #2c3e50;
    text-decoration: none;
    font-weight: 700;
  }
  .title-link:hover { text-decoration: underline; }
  .muted { color: #7f8c8d; font-size: 0.9rem; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h2 style="margin-bottom: 0.25rem;">í”¼ë“œë°± / ê³µì§€</h2>
    <div class="muted">ëª¨ë“  ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, ê³µì§€ê¸€ì€ ìµœìƒë‹¨ì— ê³ ì •ë©ë‹ˆë‹¤.</div>
  </div>
  <div style="display:flex; gap:0.5rem; align-items:center;">
    <form method="GET" action="{{ url_for('main.feedback_list') }}" style="display:flex; gap:0.5rem; align-items:center;">
      <span class="muted" style="white-space:nowrap;">ì •ë ¬</span>
      <select class="form-control" name="sort" onchange="this.form.submit()" style="width: 200px;">
        {% set s = current_sort or 'created_desc' %}
        <option value="created_desc" {% if s == 'created_desc' %}selected{% endif %}>ìµœì‹ ìˆœ (ìƒì„±ì¼)</option>
        <option value="created_asc" {% if s == 'created_asc' %}selected{% endif %}>ì˜¤ë˜ëœìˆœ (ìƒì„±ì¼)</option>
        <option value="updated_desc" {% if s == 'updated_desc' %}selected{% endif %}>ìµœì‹ ìˆœ (ì—…ë°ì´íŠ¸)</option>
        <option value="views_desc" {% if s == 'views_desc' %}selected{% endif %}>ì¡°íšŒìˆ˜ ë†’ì€ìˆœ</option>
      </select>
    </form>
    <a href="{{ url_for('main.feedback_new') }}" class="btn btn-primary">+ ìƒˆ ê¸€ ì‘ì„±</a>
  </div>
</div>

<div class="card">
  <table class="board">
    <thead>
      <tr>
        <th style="width: 120px;">êµ¬ë¶„</th>
        <th>ì œëª©</th>
        <th style="width: 180px;">ì‘ì„±ì</th>
        <th style="width: 170px;">ìƒì„±ì¼</th>
        <th style="width: 90px; text-align:right;">ì¡°íšŒìˆ˜</th>
        <th style="width: 190px;">ì—…ë°ì´íŠ¸</th>
        <th style="width: 160px; text-align:right;">ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody>
      {% if posts and posts|length > 0 %}
        {% for p in posts %}
          <tr {% if p.is_notice %}style="background:#fffdf2;"{% endif %}>
            <td>
              {% if p.is_notice %}
                <span class="pill pill-notice">ğŸ“Œ ê³µì§€</span>
              {% else %}
                <span class="muted">í”¼ë“œë°±</span>
              {% endif %}
              {% if p.is_admin_only %}
                <span class="pill pill-admin-only" style="margin-left: 0.25rem;">ğŸ”’ ê´€ë¦¬ìë§Œ</span>
              {% endif %}
            </td>
            <td>
              <a class="title-link" href="{{ url_for('main.feedback_detail', post_id=p.id) }}">{{ p.title }}</a>
            </td>
            <td class="muted">
              {{ p.creator.name if p.creator else '-' }}
            </td>
            <td class="muted">
              {{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '-' }}
            </td>
            <td class="muted" style="text-align:right;">
              {{ p.view_count if p.view_count is not none else 0 }}
            </td>
            <td class="muted">
              {{ p.updated_at.strftime('%Y-%m-%d %H:%M') if p.updated_at else (p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '-') }}
            </td>
            <td style="text-align:right;">
              {% set s = (p.status or 'To do') %}
              {% set key = s|lower|replace(" ", "")|replace("'", "") %}
              {% if key in ['todo', 'to-do', 'todo.'] %}
                <span class="status-badge status-todo">{{ s }}</span>
              {% elif key in ['inprogress', 'in-progress'] %}
                <span class="status-badge status-inprogress">{{ s }}</span>
              {% elif key in ['done'] %}
                <span class="status-badge status-done">{{ s }}</span>
              {% elif key in ['wontdo', 'wont-do', 'wontdo.'] %}
                <span class="status-badge status-wontdo">{{ s }}</span>
              {% else %}
                <span class="status-badge status-todo">{{ s }}</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="7" class="muted" style="padding: 1.5rem; text-align:center;">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}


