{% extends "base.html" %}
{% block title %}í”¼ë“œë°± ìƒì„¸{% endblock %}

{% block extra_css %}
<style>
  .meta { color:#7f8c8d; font-size:0.95rem; }
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 800;
    white-space: nowrap;
  }
  .status-todo { background: #ecf0f1; color: #2c3e50; border: 1px solid #d7dde3; }
  .status-inprogress { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
  .status-done { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
  .status-wontdo { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  .pill {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.15rem 0.55rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 800;
    border: 1px solid #ddd;
    background: #f8f9fa;
    color: #495057;
    white-space: nowrap;
  }
  .pill-notice { border-color: #f1c40f; background: #fff8db; color: #7d6608; }
  .pill-admin-only { border-color: #95a5a6; background: #ecf0f1; color: #2c3e50; }
</style>
{% endblock %}

{% block content %}
<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:1rem;">
    <div style="flex:1;">
      <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
        {% if post.is_notice %}
          <span class="pill pill-notice">ğŸ“Œ ê³µì§€</span>
        {% endif %}
        {% if post.is_admin_only %}
          <span class="pill pill-admin-only">ğŸ”’ ê´€ë¦¬ìë§Œ</span>
        {% endif %}
        {% set s = (post.status or 'To do') %}
        {% set key = s|lower|replace(" ", "")|replace("'", "") %}
        {% if key in ['todo', 'to-do', 'todo.'] %}
          <span class="status-badge status-todo">{{ s }}</span>
        {% elif key in ['inprogress', 'in-progress'] %}
          <span class="status-badge status-inprogress">{{ s }}</span>
        {% elif key in ['done'] %}
          <span class="status-badge status-done">{{ s }}</span>
        {% elif key in ['wontdo', 'wont-do', 'wontdo.'] %}
          <span class="status-badge status-wontdo">{{ s }}</span>
        {% else %}
          <span class="status-badge status-todo">{{ s }}</span>
        {% endif %}
      </div>
      <h2 style="margin-top:0.75rem; margin-bottom:0.25rem;">{{ post.title }}</h2>
      <div class="meta">
        ì‘ì„±ì: <b>{{ post.creator.name if post.creator else '-' }}</b> Â·
        ì‘ì„±: {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at else '-' }} Â·
        ì—…ë°ì´íŠ¸: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') if post.updated_at else '-' }}
      </div>
    </div>
    <div style="display:flex; gap:0.5rem; align-items:center;">
      <a href="{{ url_for('main.feedback_list') }}" class="btn btn-secondary">ëª©ë¡</a>
      {% if can_edit %}
        <a href="{{ url_for('main.feedback_edit', post_id=post.id) }}" class="btn btn-primary">ìˆ˜ì •</a>
      {% endif %}
      {% if can_delete %}
        <form method="POST" action="{{ url_for('main.feedback_delete', post_id=post.id) }}" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
          <button type="submit" class="btn btn-danger">ì‚­ì œ</button>
        </form>
      {% endif %}
    </div>
  </div>

  <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">

  <div style="white-space: pre-wrap; line-height: 1.6;">{{ post.content }}</div>

  {% if post.attachments and post.attachments|length > 0 %}
    <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">
    <h3 style="margin-bottom: 0.75rem;">ì²¨ë¶€</h3>
    <div style="display:flex; flex-direction:column; gap:1rem;">
      {% for a in post.attachments %}
        <div class="card" style="margin:0; padding:1rem; border:1px solid #eee;">
          <div style="display:flex; justify-content:space-between; gap:1rem; align-items:center; flex-wrap:wrap;">
            <div class="meta" style="word-break: break-all;">
              {{ a.original_name }}
              {% if a.file_size %}
                Â· {{ (a.file_size / 1024 / 1024)|round(2) }} MB
              {% endif %}
            </div>
            <div style="display:flex; gap:0.5rem;">
              <a class="btn btn-secondary" href="{{ url_for('main.feedback_attachment_file', attachment_id=a.id) }}" target="_blank">ë³´ê¸°</a>
              <a class="btn btn-primary" href="{{ url_for('main.feedback_attachment_file', attachment_id=a.id, download=1) }}">ë‹¤ìš´ë¡œë“œ</a>
            </div>
          </div>

          {% set mt = (a.mime_type or '') %}
          {% if mt.startswith('image/') %}
            <div style="margin-top: 0.75rem;">
              <img src="{{ url_for('main.feedback_attachment_file', attachment_id=a.id) }}"
                   alt="{{ a.original_name }}"
                   style="max-width:100%; border-radius:8px; border:1px solid #eee;">
            </div>
          {% elif mt.startswith('video/') %}
            <div style="margin-top: 0.75rem;">
              <video controls style="max-width:100%; border-radius:8px; border:1px solid #eee;">
                <source src="{{ url_for('main.feedback_attachment_file', attachment_id=a.id) }}" type="{{ a.mime_type }}">
                ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
              </video>
            </div>
          {% else %}
            <div class="meta" style="margin-top: 0.75rem;">ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹ì…ë‹ˆë‹¤.</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}


